@page "/myDestinyPage"
@using global::MyDestiny.Models
@using MyDestiny.Extensions

<PageTitle>My Destiny</PageTitle>

@* <MudText Typo="Typo.h3" GutterBottom="true">Weather forecast</MudText> *@
@if (!IsAllDone)
{
    <MudProgressCircular Color="Color.Default" Indeterminate="true"/>
}
else
{
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số đường đời: @chiSoDuongDoi</MudText>
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số sứ mệnh: @chiSoSuMenh</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số liên kết đường đời và sứ mệnh: @chiSoLienKetDuongDoiVaSuMenh</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số trưởng thành: @chiSoTruongThanh</MudText> 
    
    <MudDivider DividerType="DividerType.Middle" Class="my-6"/>
    
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số linh hồn: @chiSoLinhHon</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số nhân cách: @chiSoNhanCach</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số liên kết: @chiSoLienKet</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số cân bằng: @chiSoCanBang</MudText> 
    
    <MudDivider DividerType="DividerType.Middle" Class="my-6"/>
    
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số tư duy lý trí: @chiSoTuDuyLyTri</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số sức mạnh tiềm thức: @chiSoSucManhTiemThuc</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số đam mê: @chiSoDamMe</MudText>
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số thiếu: @chiSoThieu</MudText> 
    
    <MudDivider DividerType="DividerType.Middle" Class="my-6"/>
    
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số năm cá nhân: @chiSoNamCaNhan</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số tháng cá nhân: @chiSoThangCaNhan</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số ngày cá nhân: @chiSoNgayCaNhan</MudText> 
    
    <MudDivider DividerType="DividerType.Middle" Class="my-6"/>
    
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số chặng 1: @chiSoChang1</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số chặng 2: @chiSoChang2</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số chặng 3: @chiSoChang3</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số chặng 4: @chiSoChang4</MudText> 
    
    <MudDivider DividerType="DividerType.Middle" Class="my-6"/>
    
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số thách thức 1: @chiSoThachThuc1</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số thách thức 2: @chiSoThachThuc2</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số thách thức 3: @chiSoThachThuc3</MudText> 
    <MudText Typo="Typo.h3" GutterBottom="true">Chỉ số thách thức 4: @chiSoThachThuc4</MudText> 
}
    
@code {

    private UserInfo _userInfo = new()
    {
        HoVaTen = "Nguyễn Văn Linh",
        NgayThangNamSinh = new DateOnly(1984, 3, 12)
    };

    private bool IsAllDone = false;

    private int chiSoDuongDoi;
    private int chiSoSuMenh;
    private int chiSoLienKetDuongDoiVaSuMenh;
    private int chiSoTruongThanh;
    
    private int chiSoLinhHon;
    private int chiSoNhanCach;
    private int chiSoLienKet;
    private int chiSoCanBang;

    private int chiSoTuDuyLyTri;
    private int chiSoSucManhTiemThuc;
    private string chiSoDamMe;
    private string chiSoThieu;

    private int chiSoNamCaNhan;
    private int chiSoThangCaNhan;
    private int chiSoNgayCaNhan;
    
    private int chiSoChang1;
    private int chiSoChang2;
    private int chiSoChang3;
    private int chiSoChang4;
    
    private int chiSoThachThuc1;
    private int chiSoThachThuc2;
    private int chiSoThachThuc3;
    private int chiSoThachThuc4;

    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(1000);
        chiSoDuongDoi = _userInfo.TinhDuongDoi();
        chiSoSuMenh = _userInfo.TinhChiSoSuMenh();
        chiSoLienKetDuongDoiVaSuMenh = _userInfo.TinhChiSoLienKetDuongDoiVaSuMenh(chiSoDuongDoi, chiSoSuMenh);
        chiSoTruongThanh = _userInfo.TinhChiSoTruongThanh(chiSoDuongDoi, chiSoSuMenh);

        chiSoLinhHon = 0;
        chiSoNhanCach = 0;
        chiSoLienKet = _userInfo.TinhChiSoLienKet(chiSoLinhHon, chiSoNhanCach);
        chiSoCanBang = _userInfo.TinhChiSoCanBang();

        chiSoTuDuyLyTri = _userInfo.TinhChiSoTuDuyLyTri();
        chiSoSucManhTiemThuc = _userInfo.TinhChiSoSucManhTiemThuc();
        chiSoDamMe = _userInfo.TinhChiSoDamMe().Aggregate("", (current, item) => current + (item + ", "));
        chiSoThieu = _userInfo.TinhChiSoThieu().Aggregate("", (current, item) => current + (item + ", "));

        chiSoNamCaNhan = _userInfo.TinhNamCaNhan();
        chiSoThangCaNhan = _userInfo.TinhThangCaNhan(chiSoNamCaNhan);
        chiSoNgayCaNhan = _userInfo.TinhNgayCaNhan(chiSoThangCaNhan);
        
        chiSoChang1 = _userInfo.TinhChang1();
        chiSoChang2 = _userInfo.TinhChang2();
        chiSoChang3 = _userInfo.TinhChang3(chiSoChang1, chiSoChang2);
        chiSoChang4 = _userInfo.TinhChang4();

        chiSoThachThuc1 = _userInfo.TinhThachThuc1();
        chiSoThachThuc2 = _userInfo.TinhThachThuc2();
        chiSoThachThuc3 = _userInfo.TinhThachThuc3(chiSoThachThuc1, chiSoThachThuc2);
        chiSoThachThuc4 = _userInfo.TinhThachThuc4();
        
        IsAllDone = true;
    }
}